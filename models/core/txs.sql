{{ config(materialized='incremental', unique_key='tx_id', tags=['core']) }}

select 
    block_id,
    block_timestamp,
    tx_id,
    tx_block_index as tx_index,
    tx:bech32_from::string as native_from_address,
    tx:bech32_to::string as native_to_address,
    tx:from::string as eth_from_address,
    tx:to::string as eth_to_address,
    tx:value as amount,
    tx:gas as gas,
    tx:gas_price as gas_price,
    tx:input::string as input
from {{ deduped_txs("harmony_txs") }} q
-- Incrementaly load new data so that we don't do a full refresh each time
-- we run `dbt run` see the macro `macros/incremental_utils.sql` 
-- or https://docs.getdbt.com/docs/building-a-dbt-project/building-models/configuring-incremental-models
where {{ incremental_load_filter("block_timestamp") }}


-- {
--   "bech32_from": "one1ua97fx08qg8s5t7s0l7lg9j6vwxzxlqyd3a6nx",
--   "bech32_to": "one1f729putnqlr7u7c98zaxyfu35f8kr4r5tfmpzt",
--   "block_hash": "0xe0019ed54a34014966c0c83351eb28bf6460d0fbf438fe3b74fe75fdfb7c41e7",
--   "block_number": 19922332,
--   "from": "0xe74be499e7020f0a2fd07ffdf4165a638c237c04",
--   "gas": 832662,
--   "gas_price": 1230100000,
--   "hash": "0x2e0c578a3fa7972377d8ad1f0fe94014dace26202fe17aa27b8fc7ed0be5adaf",
--   "input": "0xe5546f37000000000000000000000000000000000000000000000000063eb89da4ed0000000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d03390000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013000000000000000000000000c35dadb65012ec5796536bd9864ed8773abc74c40000000000000000000000001b02da8cb0d097eb8d57a175b88c7d8b47997506000000000000000000000000f012702a5f0e54015362cbca26a26fc90aa832a300000000000000000000000082fdff53547141d1a4439b0bfef34ffd366e77dc000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e74be499e7020f0a2fd07ffdf4165a638c237c040000000000000000000000000000000000000000000000000000000000000005000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d03390000000000000000000000000dc78c79b4eb080ead5c1d16559225a46b580694000000000000000000000000224e64ec1bdce3870a6a6c777edd450454068fec000000000000000000000000cf664087a5bb0237a0bad6742852ec6c8d69a27a0000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013",
--   "nonce": "0x8246c",
--   "r": "0x5ca728ede3c0c7b37528522d13d2cd656a2f42156096611ec224c52937cf3a01",
--   "receipt": {
--     "bech32_from": "one1ua97fx08qg8s5t7s0l7lg9j6vwxzxlqyd3a6nx",
--     "bech32_to": "one1f729putnqlr7u7c98zaxyfu35f8kr4r5tfmpzt",
--     "blockHash": "0xe0019ed54a34014966c0c83351eb28bf6460d0fbf438fe3b74fe75fdfb7c41e7",
--     "blockNumber": "0x12ffd9c",
--     "contractAddress": "",
--     "cumulativeGasUsed": "0x1b22af5",
--     "from": "0xe74be499e7020f0a2fd07ffdf4165a638c237c04",
--     "logs": [],
--     "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
--     "status": "0x1",
--     "to": "0x4f9450f17307c7ee7b0538ba622791a24f61d474",
--     "transactionHash": "0x2e0c578a3fa7972377d8ad1f0fe94014dace26202fe17aa27b8fc7ed0be5adaf",
--     "transactionIndex": "0x47"
--   },
--   "s": "0x10ae9f0510cdedb30085fb3bcb024af066f943195ecb883c7fa12a385246aa02",
--   "to": "0x4f9450f17307c7ee7b0538ba622791a24f61d474",
--   "traces": {
--     "bech32_from": "one1ua97fx08qg8s5t7s0l7lg9j6vwxzxlqyd3a6nx",
--     "bech32_to": "one1f729putnqlr7u7c98zaxyfu35f8kr4r5tfmpzt",
--     "calls": [
--       {
--         "bech32_from": "one1f729putnqlr7u7c98zaxyfu35f8kr4r5tfmpzt",
--         "bech32_to": "one1rvpd4r9s6zt7hr2h596m3rra3drejagxen2var",
--         "calls": [
--           {
--             "bech32_from": "one1rvpd4r9s6zt7hr2h596m3rra3drejagxen2var",
--             "bech32_to": "one1ckup9x6prm6lt03zuax7dl5xcwmfueqacj5elf",
--             "calls": null,
--             "from": "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506",
--             "gas": "0xb869f",
--             "gasUsed": "0x4c1",
--             "input": "0x0902f1ac",
--             "output": "0x000000000000000000000000000000000000000000000023779992a2a15ec81200000000000000000000000000000000000000000002673d91195c10ddd37ed50000000000000000000000000000000000000000000000000000000061a59d0c",
--             "time": "",
--             "to": "0xc5b8129b411ef5f5be22e74de6fe86c3b69e641d",
--             "type": "STATICCALL",
--             "value": ""
--           }
--         ],
--         "from": "0x4f9450f17307c7ee7b0538ba622791a24f61d474",
--         "gas": "0xbc329",
--         "gasUsed": "0x17f6",
--         "input": "0xd06ca61f000000000000000000000000000000000000000000000000063eb89da4ed0000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d0339",
--         "output": "0x",
--         "time": "",
--         "to": "0x1b02da8cb0d097eb8d57a175b88c7d8b47997506",
--         "type": "STATICCALL",
--         "value": ""
--       },
--       {
--         "bech32_from": "one1f729putnqlr7u7c98zaxyfu35f8kr4r5tfmpzt",
--         "bech32_to": "one17qf8q2jlpe2qz5mze09zdgn0ey92sv4r323k20",
--         "calls": [
--           {
--             "bech32_from": "one17qf8q2jlpe2qz5mze09zdgn0ey92sv4r323k20",
--             "bech32_to": "one1hr6vqmwsctu7khn8kna294t07d2r6em9cucg5s",
--             "calls": null,
--             "from": "0xf012702a5f0e54015362cbca26a26fc90aa832a3",
--             "gas": "0xb5894",
--             "gasUsed": "0x4b4",
--             "input": "0x0902f1ac",
--             "output": "0x0000000000000000000000000000000000000000000000000000037e49a2c75500000000000000000000000000000000000000000005b34c6ceaaad62a380f7d0000000000000000000000000000000000000000000000000000000061a59cad",
--             "time": "",
--             "to": "0xb8f4c06dd0c2f9eb5e67b4faa2d56ff3543d6765",
--             "type": "STATICCALL",
--             "value": ""
--           },
--           {
--             "bech32_from": "one17qf8q2jlpe2qz5mze09zdgn0ey92sv4r323k20",
--             "bech32_to": "one16l3n9dxfl9l2d5zahrpc7yenq7kcs3lnfhauu2",
--             "calls": null,
--             "from": "0xf012702a5f0e54015362cbca26a26fc90aa832a3",
--             "gas": "0xb4683",
--             "gasUsed": "0x4b4",
--             "input": "0x0902f1ac",
--             "output": "0x00000000000000000000000000000000000000000000000000000148302a70c9000000000000000000000000000000000000000000020cfb5d94c4ba4e03ab5d0000000000000000000000000000000000000000000000000000000061a59cc6",
--             "time": "",
--             "to": "0xd7e332b4c9f97ea6d05db8c38f133307ad8847f3",
--             "type": "STATICCALL",
--             "value": ""
--           },
--           {
--             "bech32_from": "one17qf8q2jlpe2qz5mze09zdgn0ey92sv4r323k20",
--             "bech32_to": "one1v46qymd5tw5df9ffz3ggqjyu8kn34qkltgyj7g",
--             "calls": null,
--             "from": "0xf012702a5f0e54015362cbca26a26fc90aa832a3",
--             "gas": "0xb347b",
--             "gasUsed": "0x4b4",
--             "input": "0x0902f1ac",
--             "output": "0x000000000000000000000000000000000000000000003aa3318affb2fd9b528700000000000000000000000000000000000000000000df986dda6a69cf8a87c30000000000000000000000000000000000000000000000000000000061a59cf9",
--             "time": "",
--             "to": "0x6574026db45ba8d49529145080489c3da71a82df",
--             "type": "STATICCALL",
--             "value": ""
--           },
--           {
--             "bech32_from": "one17qf8q2jlpe2qz5mze09zdgn0ey92sv4r323k20",
--             "bech32_to": "one1remejzthh4er7jl6al4x30ehy33xs0az244ud3",
--             "calls": null,
--             "from": "0xf012702a5f0e54015362cbca26a26fc90aa832a3",
--             "gas": "0xb2260",
--             "gasUsed": "0x4b4",
--             "input": "0x0902f1ac",
--             "output": "0x000000000000000000000000000000000000000000000002f6b3aa875dfba15d00000000000000000000000000000000000000000000c1bbb8c1ae6dce9ed7a20000000000000000000000000000000000000000000000000000000061a59cf5",
--             "time": "",
--             "to": "0x1e77990977bd723f4bfaefea68bf372462683fa2",
--             "type": "STATICCALL",
--             "value": ""
--           }
--         ],
--         "from": "0x4f9450f17307c7ee7b0538ba622791a24f61d474",
--         "gas": "0xb9411",
--         "gasUsed": "0x4f6c",
--         "input": "0xd06ca61f00000000000000000000000000000000000000000000006bee7958323912d60000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000005000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d03390000000000000000000000000dc78c79b4eb080ead5c1d16559225a46b580694000000000000000000000000224e64ec1bdce3870a6a6c777edd450454068fec000000000000000000000000cf664087a5bb0237a0bad6742852ec6c8d69a27a0000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013",
--         "output": "0x",
--         "time": "",
--         "to": "0xf012702a5f0e54015362cbca26a26fc90aa832a3",
--         "type": "STATICCALL",
--         "value": ""
--       }
--     ],
--     "from": "0xe74be499e7020f0a2fd07ffdf4165a638c237c04",
--     "gas": "0xc4c66",
--     "gasUsed": "0xe16b",
--     "input": "0xe5546f37000000000000000000000000000000000000000000000000063eb89da4ed0000000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d03390000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013000000000000000000000000c35dadb65012ec5796536bd9864ed8773abc74c40000000000000000000000001b02da8cb0d097eb8d57a175b88c7d8b47997506000000000000000000000000f012702a5f0e54015362cbca26a26fc90aa832a300000000000000000000000082fdff53547141d1a4439b0bfef34ffd366e77dc000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000e74be499e7020f0a2fd07ffdf4165a638c237c040000000000000000000000000000000000000000000000000000000000000005000000000000000000000000ef977d2f931c1978db5f6747666fa1eacb0d03390000000000000000000000000dc78c79b4eb080ead5c1d16559225a46b580694000000000000000000000000224e64ec1bdce3870a6a6c777edd450454068fec000000000000000000000000cf664087a5bb0237a0bad6742852ec6c8d69a27a0000000000000000000000006983d1e6def3690c4d616b13597a09e6193ea013",
--     "output": "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000b616d6f6f756e74206e6f31000000000000000000000000000000000000000000",
--     "time": "748.855682ms",
--     "to": "0x4f9450f17307c7ee7b0538ba622791a24f61d474",
--     "type": "CALL",
--     "value": "0x0"
--   },
--   "transactionIndex": 0,
--   "v": "0xc6ac98a3",
--   "value": 0
-- }